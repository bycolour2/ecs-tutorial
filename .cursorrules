# Cursor Rules — ECS Idle Game Project

## Общие принципы
- Проект — детерминированный симулятор состояния (idle-игра).
- Игровая логика реализуется через ECS (Entity / Component / System).
- UI (React) — только viewer, не источник истины.
- Backend (Hono) — authoritative, симулирует тот же ECS-core.

## Архитектура
- core/ — чистая ECS-логика, без DOM, Date, Math.random, fetch.
- frontend/ — React, читает snapshot состояния.
- backend/ — Hono API, хранение состояния, симуляция ECS.
- core должен быть изоморфным (используется и на FE, и на BE).

## ECS правила
- Entity — только числовой ID.
- Component — только данные, без методов и логики.
- System — чистая функция `(world, deltaMs) => void`.
- Системы не вызывают другие системы напрямую.
- Нет if-else логики по типам сущностей — только через компоненты.
- Любая механика должна быть выразима через добавление компонента.

## Game Loop
- Используется фиксированный timestep.
- Поддерживается fast-forward и offline progress.
- Вся симуляция происходит через `simulate(world, deltaMs)`.

## Апгрейды и модификаторы
- Апгрейды не применяются сразу — они создают данные (pending).
- Модификаторы аддитивные по умолчанию.
- Итоговые значения считаются агрегирующими системами.
- Никакой логики расчёта в UI.

## События
- Пользовательский ввод представлен как events/actions.
- Events складываются в очередь и обрабатываются системой.
- FE не мутирует world напрямую.

## Backend
- Сервер хранит состояние мира.
- Клиент отправляет actions, получает snapshot.
- Возможен replay событий.
- Хранилище: PostgreSQL или MongoDB (абстрагировано через repository).

## Стиль кода
- TypeScript strict.
- Явные типы важнее краткости.
- Предпочтение функциональному стилю.
- Минимум магии, максимум прозрачности.

## Запрещено
- Логика игры в React.
- Date.now() внутри core.
- Math.random() без seed.
- Мутация world из UI.
